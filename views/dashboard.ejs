<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MineTrade Dashboard</title>
  <style>
    body {
      background-color: #0a0a0a;
      color: #ffd700;
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* Sidebar */
    .sidebar {
      width: 220px;
      background-color: #111;
      color: #ffd700;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 40px;
      box-shadow: 2px 0 8px rgba(0, 0, 0, 0.5);
    }

    .sidebar h2 {
      font-size: 20px;
      margin-bottom: 30px;
    }

    .sidebar button {
      background: none;
      border: none;
      color: #ffd700;
      font-size: 16px;
      margin: 10px 0;
      cursor: pointer;
      transition: color 0.2s;
      width: 100%;
      padding: 10px;
      text-align: left;
      padding-left: 30px;
    }

    .sidebar button:hover,
    .sidebar button.active {
      color: #fff;
      background-color: #222;
    }

    /* Main content */
    .content {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
    }

    .container {
      max-width: 800px;
      margin: auto;
      background-color: #111;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 0 20px #222;
    }

    h1 {
      text-align: center;
      margin-bottom: 25px;
    }

    input, textarea, select {
      width: 90%;
      margin: 10px;
      padding: 8px;
      border: none;
      border-radius: 5px;
      background-color: #1a1a1a;
      color: #ffd700;
    }

    input[type="color"] {
      width: 60px;
      height: 40px;
      padding: 0;
      border: none;
      cursor: pointer;
    }

    button {
      background-color: #ffd700;
      color: #000;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }

    button:hover { background-color: #e5c100; }

    .success {
      background-color: #16a34a;
      color: white;
      padding: 8px;
      border-radius: 5px;
      margin-bottom: 10px;
      text-align: center;
    }

    .pair {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .pair input, .pair select { width: auto; flex: 1; }

    #reaction-pairs { margin-top: 10px; }

    a.logout {
      color: #888;
      text-decoration: none;
      display: block;
      text-align: center;
      margin-top: 20px;
    }

    /* Embed preview */
    #preview {
      background-color: #111;
      color: #fff;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      text-align: left;
    }

    .embed-box {
      background-color: #2f3136;
      border-left: 5px solid #ffd700;
      border-radius: 8px;
      padding: 15px;
      margin-top: 10px;
    }

    .embed-title { font-weight: bold; color: #ffffff; margin-bottom: 5px; }
    .embed-desc { color: #dcdcdc; margin-bottom: 10px; }
    .embed-footer { font-size: 12px; color: #999; border-top: 1px solid #3a3a3a; padding-top: 5px; }

    /* Reaction Role List */
    .reaction-list { margin-top: 20px; background:#1a1a1a; border-radius:10px; padding:15px; }
    .reaction-item { border-bottom:1px solid #333; padding:10px 0; }
    .reaction-item:last-child{ border-bottom:none; }
    .channel-name { color:#ffd700; font-weight:bold; margin-top:15px; }
    .edit-form input, .edit-form textarea, .edit-form select { width:95%; }
    .delete-btn { background:#ff4d4d; color:#fff; margin-top:5px; }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <h2>üíé MineTrade</h2>
    <button id="tab-embed" class="active">üìã Embed Builder</button>
    <button id="tab-reaction">üé≠ Reaction Roles</button>
    <a href="/logout" class="logout">Logout</a>
  </div>

  <!-- Main content -->
  <div class="content">

    <!-- Embed Builder Tab -->
    <div id="embed-tab" class="container tab active">
      <h1>üìã Embed Builder</h1>
      <% if (message) { %>
        <div class="success"><%= message %></div>
      <% } %>
      <form action="/send" method="POST">
        <select name="channelId" required>
          <option value="">Select Channel</option>
          <% channels.forEach(ch => { %>
            <option value="<%= ch.id %>">#<%= ch.name %></option>
          <% }) %>
        </select><br>

        <input type="text" name="title" id="title" placeholder="Embed Title" /><br>
        <textarea name="description" id="description" rows="5" placeholder="Embed Description"></textarea><br>

        <label for="color">üé® Pick a color:</label><br>
        <input type="color" name="color" id="color" value="#FFD700"><br>

        <label>
          <input type="checkbox" name="restock"> üîî Ping Restock Role
        </label><br><br>

        <input type="text" name="footer" id="footer" placeholder="Footer Text" /><br>
        <button type="submit">Send Embed</button>
      </form>

      <div id="preview">
        <h3>üìã Embed Preview</h3>
        <div id="embed-preview" class="embed-box">
          <div class="embed-title">Title Preview</div>
          <div class="embed-desc">This is how your embed will look in Discord.</div>
          <div class="embed-footer">MineTrade | Embed System</div>
        </div>
      </div>
    </div>

    <!-- Reaction Roles Tab -->
    <div id="reaction-tab" class="container tab" style="display:none;">
      <h1>üé≠ Reaction Roles</h1>

      <!-- Create new Reaction Role -->
      <form action="/reactionrole" method="POST">
        <select name="channelId" required>
          <option value="">Select Channel</option>
          <% channels.forEach(ch => { %>
            <option value="<%= ch.id %>">#<%= ch.name %></option>
          <% }) %>
        </select><br>

        <input type="text" name="title" placeholder="Embed Title" /><br>
        <textarea name="description" rows="5" placeholder="Embed Description"></textarea><br>
        <label for="color">üé® Pick a color:</label><br>
        <input type="color" name="color" value="#FFD700"><br>
        <input type="text" name="footer" placeholder="Footer Text" /><br>

        <h3>üß© Emoji ‚Üí Role Pairs</h3>
        <div id="reaction-pairs"></div>
        <button type="button" id="add-pair">+ Add Pair</button><br><br>
        <button type="submit">Send Reaction Role Message</button>
      </form>

      <!-- Active Reaction Roles -->
      <h3 style="margin-top:30px;">Active Reaction Role Messages</h3>
      <div class="reaction-list">
        <% 
        const grouped = {};
        Object.entries(rrData).forEach(([msgId, data]) => {
          if (!grouped[data.channelName]) grouped[data.channelName] = [];
          grouped[data.channelName].push({ id: msgId, ...data });
        });
        Object.entries(grouped).forEach(([channel, embeds]) => { %>
          <div class="channel-name">üí¨ #<%= channel %></div>
          <% embeds.forEach(e => { %>
            <div class="reaction-item">
              <form class="edit-form" action="/reactionrole/update" method="POST">
                <input type="hidden" name="messageId" value="<%= e.id %>" />
                <label>Title</label>
                <input type="text" name="title" value="<%= e.embed.title || '' %>" />

                <label>Description</label>
                <textarea name="description" rows="2"><%= e.embed.description || '' %></textarea>

                <label>Color</label>
                <input type="color" name="color" value="<%= e.embed.color || '#FFD700' %>" />

                <label>Footer</label>
                <input type="text" name="footer" value="<%= e.embed.footer || '' %>" />

                <label>Emoji‚ÄìRole Pairs</label>
                <% e.pairs.forEach((p, i) => { %>
                  <div class="pair">
                    <input type="text" name="emoji_<%= i+1 %>" value="<%= p.emoji %>" />
                    <select name="role_<%= i+1 %>">
                      <% roles.forEach(r => { %>
                        <option value="<%= r.id %>" <%= r.id === p.roleId ? 'selected' : '' %>><%= r.name %></option>
                      <% }) %>
                    </select>
                    <button type="button" onclick="this.parentElement.remove()">‚ùå</button>
                  </div>
                <% }) %>

                <button type="submit">üíæ Update</button>
              </form>
              <form action="/reactionrole/delete" method="POST">
                <input type="hidden" name="messageId" value="<%= e.id %>" />
                <button type="submit" class="delete-btn">üóëÔ∏è Delete</button>
              </form>
            </div>
          <% }) %>
        <% }) %>
      </div>
    </div>
  </div>

  <script>
    // === Sidebar Tab Switcher ===
    const embedTabBtn = document.getElementById('tab-embed');
    const reactionTabBtn = document.getElementById('tab-reaction');
    const embedTab = document.getElementById('embed-tab');
    const reactionTab = document.getElementById('reaction-tab');

    embedTabBtn.addEventListener('click', () => {
      embedTab.style.display = '';
      reactionTab.style.display = 'none';
      embedTabBtn.classList.add('active');
      reactionTabBtn.classList.remove('active');
    });

    reactionTabBtn.addEventListener('click', () => {
      reactionTab.style.display = '';
      embedTab.style.display = 'none';
      reactionTabBtn.classList.add('active');
      embedTabBtn.classList.remove('active');
    });

    // === Embed Preview ===
    const title = document.getElementById('title');
    const desc = document.getElementById('description');
    const footer = document.getElementById('footer');
    const color = document.getElementById('color');
    const preview = document.getElementById('embed-preview');
    function updatePreview() {
      preview.style.borderLeft = `5px solid ${color.value}`;
      preview.querySelector('.embed-title').textContent = title.value || 'Embed Title';
      preview.querySelector('.embed-desc').textContent = desc.value || 'This is how your embed will look in Discord.';
      preview.querySelector('.embed-footer').textContent = footer.value || 'MineTrade | Embed System';
    }
    [title, desc, footer, color].forEach(el => el.addEventListener('input', updatePreview));

    // === Reaction Role Pair Adder ===
    const pairsDiv = document.getElementById('reaction-pairs');
    const addPairBtn = document.getElementById('add-pair');
    let pairIndex = 1;
    addPairBtn.addEventListener('click', () => {
      const div = document.createElement('div');
      div.className = 'pair';
      div.innerHTML = `
        <input type="text" name="emoji_${pairIndex}" placeholder="Emoji (üíé)" required>
        <select name="role_${pairIndex}" required>
          <option value="">Select Role</option>
          <% roles.forEach(r => { %>
            <option value="<%= r.id %>"><%= r.name %></option>
          <% }) %>
        </select>
        <button type="button" onclick="this.parentElement.remove()">‚ùå</button>
      `;
      pairsDiv.appendChild(div);
      pairIndex++;
    });
  </script>
</body>
</html>
