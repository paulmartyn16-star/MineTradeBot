<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MineTrade Dashboard</title>
    <style>
      body {
        background-color: #0d0d0d;
        color: #f5f5f5;
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
      }
      header {
        background-color: #111;
        padding: 15px;
        text-align: center;
        font-size: 1.5em;
        color: #ffd700;
        border-bottom: 2px solid #ffd700;
      }
      main {
        padding: 20px;
        max-width: 1000px;
        margin: 0 auto;
      }
      h2 {
        color: #ffd700;
        margin-top: 40px;
        border-bottom: 1px solid #333;
        padding-bottom: 5px;
      }
      form {
        margin-top: 10px;
        background-color: #1a1a1a;
        padding: 15px;
        border-radius: 10px;
        border: 1px solid #333;
      }
      label {
        display: block;
        margin-top: 10px;
        font-weight: bold;
      }
      input, select, textarea {
        width: 100%;
        padding: 6px;
        margin-top: 4px;
        border-radius: 6px;
        border: none;
        background: #222;
        color: #fff;
      }
      button {
        margin-top: 15px;
        padding: 10px 20px;
        background: #ffd700;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
      }
      button:hover { background: #e6c200; }
      .message {
        color: #00ff7f;
        margin-top: 10px;
      }
      .reaction-list {
        margin-top: 10px;
        padding: 10px;
        background: #111;
        border-radius: 8px;
      }
      .reaction-item {
        padding: 8px;
        border-bottom: 1px solid #333;
      }
      .reaction-item:last-child {
        border-bottom: none;
      }
      .channel-name {
        font-weight: bold;
        color: #ffd700;
      }
    </style>
  </head>

  <body>
    <header>üíé MineTrade Dashboard</header>
    <main>
      <h2>ü™Ñ Embed Builder</h2>
      <form action="/send" method="POST">
        <label>Channel</label>
        <select name="channelId" required>
          <% channels.forEach(ch => { %>
            <option value="<%= ch.id %>">#<%= ch.name %></option>
          <% }) %>
        </select>

        <label>Title</label>
        <input type="text" name="title" placeholder="Embed Title" />

        <label>Description</label>
        <textarea name="description" rows="3" placeholder="Embed description..."></textarea>

        <label>Color (hex)</label>
        <input type="text" name="color" placeholder="#FFD700" />

        <label>Footer</label>
        <input type="text" name="footer" placeholder="Footer text..." />

        <label>
          <input type="checkbox" name="restock" />
          üîî Ping Restock Role
        </label>

        <button type="submit">üì§ Send Embed</button>
      </form>

      <% if (message) { %>
        <p class="message"><%= message %></p>
      <% } %>

      <h2>üé≠ Reaction Roles</h2>

      <!-- Neue Reaction Role erstellen -->
      <form action="/reactionrole" method="POST">
        <label>Channel</label>
        <select name="channelId" required>
          <% channels.forEach(ch => { %>
            <option value="<%= ch.id %>">#<%= ch.name %></option>
          <% }) %>
        </select>

        <label>Title</label>
        <input type="text" name="title" placeholder="Reaction Role Title" />

        <label>Description</label>
        <textarea name="description" rows="3" placeholder="Description"></textarea>

        <label>Color (hex)</label>
        <input type="text" name="color" placeholder="#FFD700" />

        <label>Footer</label>
        <input type="text" name="footer" placeholder="Footer text" />

        <div id="pairs">
          <label>Emoji‚ÄìRole Pairs</label>
          <div>
            <input type="text" name="emoji_1" placeholder="Emoji" style="width: 20%" />
            <select name="role_1" style="width: 75%">
              <% roles.forEach(r => { %>
                <option value="<%= r.id %>">@<%= r.name %></option>
              <% }) %>
            </select>
          </div>
        </div>
        <button type="button" onclick="addPair()">‚ûï Add Pair</button>
        <button type="submit">üì© Create Reaction Role</button>
      </form>

      <script>
        let pairCount = 1;
        function addPair() {
          pairCount++;
          const div = document.createElement("div");
          div.innerHTML = `
            <input type="text" name="emoji_${pairCount}" placeholder="Emoji" style="width: 20%" />
            <select name="role_${pairCount}" style="width: 75%">
              ${document.querySelector("select[name='role_1']").innerHTML}
            </select>
          `;
          document.getElementById("pairs").appendChild(div);
        }
      </script>

      <!-- Aktive Reaction Roles anzeigen -->
      <h3 style="margin-top:40px;color:#ffd700;">Active Reaction Roles</h3>
      <div class="reaction-list">
        <% 
        const grouped = {};
        Object.entries(rrData).forEach(([msgId, data]) => {
          if (!grouped[data.channelName]) grouped[data.channelName] = [];
          grouped[data.channelName].push({ id: msgId, ...data });
        });
        Object.entries(grouped).forEach(([channel, embeds]) => { %>
          <div class="channel-name">üí¨ #<%= channel %></div>
          <% embeds.forEach(e => { %>
            <div class="reaction-item">
              <form action="/reactionrole/update" method="POST">
                <input type="hidden" name="messageId" value="<%= e.id %>" />
                <label>Title</label>
                <input type="text" name="title" value="<%= e.embed.title || '' %>" />

                <label>Description</label>
                <textarea name="description" rows="2"><%= e.embed.description || '' %></textarea>

                <label>Color</label>
                <input type="text" name="color" value="<%= e.embed.color || '#FFD700' %>" />

                <label>Footer</label>
                <input type="text" name="footer" value="<%= e.embed.footer || '' %>" />

                <label>Emoji‚ÄìRole Pairs</label>
                <% e.pairs.forEach((p, i) => { %>
                  <div>
                    <input type="text" name="emoji_<%= i+1 %>" value="<%= p.emoji %>" style="width: 20%" />
                    <select name="role_<%= i+1 %>" style="width: 75%">
                      <% roles.forEach(r => { %>
                        <option value="<%= r.id %>" <%= r.id === p.roleId ? 'selected' : '' %>>@<%= r.name %></option>
                      <% }) %>
                    </select>
                  </div>
                <% }) %>

                <button type="submit">üíæ Update</button>
              </form>

              <form action="/reactionrole/delete" method="POST" style="margin-top:5px;">
                <input type="hidden" name="messageId" value="<%= e.id %>" />
                <button type="submit" style="background:#ff4d4d;">üóëÔ∏è Delete</button>
              </form>
            </div>
          <% }) %>
        <% }) %>
      </div>
    </main>
  </body>
</html>
